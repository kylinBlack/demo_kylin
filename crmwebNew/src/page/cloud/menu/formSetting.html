<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>表单设置</title>
    <style>
        .page-layout {
            display: flex;
            height: 100%;
            width: 100%;
        }

        /*左侧样式*/

        .show-content {
            width: 75%;
            padding: 20px;
            padding-left: 50px;
        }

        .show-content-header {
            border-bottom: 1px dashed #eee;
            height: 30px;
            line-height: 30px;
        }

        .show-content-header .show-content-header-operate {
            float: right;
            color: #428bca;
            cursor: pointer;
        }

        .show-content-header .show-content-header-title {
            font-size: 18px;
        }

        .show-content-body {
            height: 85%;
            padding: 20px 0;
        }

        .show-content-body .item {
            height: 100%;
        }

        .show-content-body .item .item-title {
            height: 30px;
            line-height: 30px;
            border-bottom: 1px dashed #eee;
            color: #428bca;
        }

        .item-title-info {
            display: inline-block;
            cursor: pointer;
        }

        .show-content-body .item .item-content {
            height: 100%;
            min-height: 40px;
            padding: 20px 0;
            overflow: hidden;
            /*清除子元素浮动导致父元素塌陷的问题*/
        }

        .show-content-body .item .item-content .left-style {
            float: left;
            /*width: 50%;
			border: 1px dashed rgb(205, 197, 211);*/
            margin-bottom: 10px;
            /*border: 1px dashed #CDC5D3;*/
            position: relative;
            /*margin-left: 5px;*/
            /*margin-right: 1px;*/
            cursor: pointer;
            display: inline;
            /*padding: 9px;*/
            /*border-radius: 2px;*/
        }

        .left-style .left-content {
            border: 1px dashed rgb(205, 197, 211);
            background: #FDFDFD;
            height: 35px;
            line-height: 35px;
            margin-right: 10px;
            padding-left: 10px;
        }

        .left-content .flied-name {
            display: inline-block;
        }


        /*右侧样式*/

        .field-content {
            flex: 1;
            border: 1px solid #eee;
            box-shadow: 5px 5px 5px #eee;
        }

        .field-select-content {
            padding: 20px;
            /*box-shadow: 5px 5px 5px #eee;*/
            /*border: 1px solid #eee;*/
        }

        .field-content-header .title {
            height: 30px;
            line-height: 30px;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .field-list {
            /*设置右侧字段区域最小高度 */
            height: 620px;
            overflow-y: scroll;
        }

        .field-list .field-list-item {
            height: 30px;
            line-height: 30px;
            border-bottom: 1px solid #eee;
            cursor: move;
        }

        .field-list .field-list-item:hover {
            color: #428bca;
        }

        .right-style {
            position: relative;
            display: block;
            /*padding: .75rem 1.25rem;*/
            margin-bottom: -1px;
            background-color: #fff;
            /*border: 1px solid rgba(0,0,0,.125);*/
            cursor: move;
        }

        .right-style .left-content {
            border: 1px solid rgba(0, 0, 0, .125);
            height: 35px;
            line-height: 35px;
            margin-right: 10px;
            padding-left: 10px;
        }

        .lp3 {
            padding-left: 3px;
            ;
        }

        .field-list::-webkit-scrollbar {
            width: 6px;
            /*滚动条宽度*/
            height: 16px;
            /*滚动条高度*/
        }

        /*菜单左侧滚动条 自定义 修改颜色*/

        /*定义滚动条轨道 内阴影+圆角*/

        .field-list::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            /*滚动条的背景区域的圆角*/
            background-color: #fff;
            /*滚动条的背景颜色*/
        }

        /*定义滑块 内阴影+圆角*/

        .field-list::-webkit-scrollbar-thumb {
            width: 6px;
            height: 10px;
            background-color: #C2C2C2;
            border-radius: 3px;
        }

        .red {
            color: #ff0000;
            padding-right: 3px;
        }

        .per96 {
            width: 96%;
        }

        .opeateBtn {
            float: right;
            margin-right: 40px;
            color: #428bca;
            cursor: pointer;
        }

        .pl12 {
            padding-left: 12px;
            ;
        }

        .lineBarName {
            padding-left: 12px;
        }

        .field-hide {
            opacity: 0.5;
        }

        .col-12 {
            width: 100%;
        }

        .col-6 {
            width: 50%;
        }

        .col-4 {
            width: 33.3%;
        }

        .col-3 {
            width: 25%;
        }
    </style>

</head>

<body style="background: #fff;">
    <div class="page-layout">
        <div class="show-content">
            <div class="show-content-header">
                <div class="show-content-header-operate editLineBarBtn">新建分线栏</div>
                <div class="show-content-header-title">表单显示设置</div>
            </div>
            <div class="show-content-body">
                <input type="hidden" id="id" />
                <div class="item">
                    <ul class="item-content" id="right">

                    </ul>
                </div>
            </div>
        </div>
        <div class="field-content">
            <div class="field-select-content">
                <div class="field-content-header">
                    <div class="title">备选字段</div>
                    <div class="field-list-content">
                        <ul class="field-list" id="left"></ul>
                    </div>
                </div>
            </div>
            <div class="save-operate" style="float: right;margin: 20px 0">
                <button class="btn btn-primary" type="button" onclick="saveViewSetting()">保存</button>
                <button class="btn btn-default" type="button" onclick="javascript:window.parent.cloudOpenWindow(false);" style="margin-right:20px;">取消</button>
            </div>
        </div>

    </div>

    <!--修改分线栏 -->
    <div class="modal fade" id="editLineBarModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:600px;">
            <div class="modal-content">
                <div class="modal-header" style="color: #fff;height: 54px;overflow: hidden;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title no-icons" id="editLineBarModalTitle">修改分线栏</h4>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-xs-3 form-label">名称</label>
                            <div class="col-xs-8">
                                <input type="text" class="form-control" name="name" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-xs-3"><input name="is_show" value="0" type="checkbox" /></label>
                            <div class="col-xs-8">
                                <label class="checkbox-inline" style="padding-left: 0px;"> 是否默认收起 </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="text-align:right;">
                    <button type="button" class="btn btn-primary">保存</button>
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true" style="margin-right:10px;">取消</button>
                </div>
            </div>
        </div>
    </div>


    <!-- 修改字段名称、宽度-->
    <div class="modal fade" id="editFieldModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:600px;">
            <div class="modal-content">
                <div class="modal-header" style="color: #fff;height: 54px;overflow: hidden;">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title no-icons" id="viewFieldNameTitle">字段属性</h4>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label col-xs-3 form-label">名称</label>
                            <div class="col-xs-8">
                                <input type="text" class="form-control" name="name" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-xs-3 form-label">宽度</label>
                            <div class="col-xs-8">
                                <select type="text" class="form-control" name="elem_width">
								<option value="12">整行</option>
								<option value="6">半行</option>
								<option value="4">1/3行</option>
								<option value="3">1/4行</option>
							</select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="text-align:right;">
                    <button type="button" class="btn btn-primary">保存</button>
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true" style="margin-right:10px;">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!--修改字段属性模态框-->
    <div class="modal fade in" id="fieldAttrModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
        <div class="modal-dialog" style="width:550px;margin-top:100px;margin-left:180px;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title no-icons" id="myModalLabel">修改字段属性</h4>
                </div>
                <div class="modal-body form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-xs-2">字段名称</label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control" id="fieldName" name="lastAssignOn" value="最近分配时间">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">字段说明</label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control" id="f-description" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">字段属性</label>
                        <div class="col-xs-9">
                            <input type="text" class="form-control" id="fieldType" name="datetime" data="datetime" disabled="" value="[lastAssignOn]">
                        </div>
                    </div>
                    <div class="form-group" id="coldiv">
                        <label class="control-label col-xs-2">字段宽度</label>
                        <div class="col-xs-9">
                            <label class="radio-inline"><input type="radio" name="col_show" id="one_col" value="one_col"> 显示单列</label>&nbsp;&nbsp;
                            <label class="radio-inline"><input type="radio" name="col_show" id="two_col" value="two_col" checked=""> 显示双列</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">是否必填</label>
                        <div class="col-xs-9">
                            <label class="checkbox-inline"><input type="checkbox" id="req_check" value="">&nbsp;必填
                        </label></div>
                    </div>


                    <!-- 多选字段 -->
                    <!-- 时间 -->
                    <div id="datetime_div">
                        <hr>
                        <div class="form-group">
                            <label class="control-label col-xs-2">字段长度</label>
                            <div class="col-xs-9">
                                <div class="select2-container" id="s2id_datetime-length" style="width:100%"><a href="javascript:void(0)" class="select2-choice" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-4">年-月-日 时:分:秒</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation" class="fa fa-angle-down"></b></span></a>
                                    <label for="s2id_autogen4" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen"
                                        type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-4" id="s2id_autogen4">
                                    <div class="select2-drop select2-display-none select2-with-searchbox">
                                        <div class="select2-search"> <label for="s2id_autogen4_search" class="select2-offscreen"></label> <input type="text"
                                                autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                                class="select2-input" role="combobox" aria-expanded="true" aria-autocomplete="list"
                                                aria-owns="select2-results-4" id="s2id_autogen4_search" placeholder=""> </div>
                                        <ul class="select2-results" role="listbox" id="select2-results-4"> </ul>
                                    </div>
                                </div><select id="datetime-length" style="width:100%" tabindex="-1" title="" class="select2-offscreen">
                            <option value="1">年</option>
                            <option value="2">年-月</option>
                            <option value="3">年-月-日</option>
                            <option value="4">年-月-日 时</option>
                            <option value="5">年-月-日 时:分</option>
                            <option value="6" selected="">年-月-日 时:分:秒</option>
                        </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label col-xs-2">默认值</label>
                            <div class="col-xs-3">
                                <div class="select2-container" id="s2id_date-defaultV" style="width:100%"><a href="javascript:void(0)" class="select2-choice" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-5">空值</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation" class="fa fa-angle-down"></b></span></a>
                                    <label for="s2id_autogen5" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen"
                                        type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-5" id="s2id_autogen5">
                                    <div class="select2-drop select2-display-none select2-with-searchbox">
                                        <div class="select2-search"> <label for="s2id_autogen5_search" class="select2-offscreen"></label> <input type="text"
                                                autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                                                class="select2-input" role="combobox" aria-expanded="true" aria-autocomplete="list"
                                                aria-owns="select2-results-5" id="s2id_autogen5_search" placeholder=""> </div>
                                        <ul class="select2-results" role="listbox" id="select2-results-5"> </ul>
                                    </div>
                                </div><select id="date-defaultV" style="width:100%" tabindex="-1" title="" class="select2-offscreen">
                            <option value="date-nullV" selected="">空值</option>
                            <option value="date-nowV">当前时间</option>
                            <option value="date-appointV">指定值</option>
                            <option value="date-computeV">计算公式</option>
                        </select>
                            </div>
                            <div class="col-xs-6">
                                <input type="text" readonly="" class="form-control" value="" id="datetime_default_value" style="display: none;">
                                <div class="form-group">
                                    <div class="col-xs-8">
                                        <div style="margin-top: 5px; padding: 5px; width: 100%; border: 1px dashed rgb(153, 153, 153); min-height: 30px; display: none;"
                                            id="date_compute_express_label"></div>
                                        <div style="display:none;" id="date_compute_express"></div>
                                    </div>
                                    <div class="col-xs-1">
                                        <button type="button" style="display:none;" class="btn btn-primary edit-date-compute-express" onclick="FM.showComputeExpress('lastAssignOn','number');">选择</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 文本区-->
                    <!--多级级联分类-->
                    <!--多级级联地区-->
                    <!-- 条码字段 -->
                    <!-- 引用字段 -->
                    <div class="form-group" id="date-compute-unit" style="display:none">
                        <label class="control-label col-xs-2">计算单位</label>
                        <div class="col-xs-9">
                            <div class="select2-container" id="s2id_date-unit" title="" style="width:100%"><a href="javascript:void(0)" class="select2-choice" tabindex="-1">   <span class="select2-chosen" id="select2-chosen-6">天</span><abbr class="select2-search-choice-close"></abbr>   <span class="select2-arrow" role="presentation"><b role="presentation" class="fa fa-angle-down"></b></span></a>
                                <label for="s2id_autogen6" class="select2-offscreen"></label><input class="select2-focusser select2-offscreen"
                                    type="text" aria-haspopup="true" role="button" aria-labelledby="select2-chosen-6" id="s2id_autogen6">
                                <div class="select2-drop select2-display-none select2-with-searchbox">
                                    <div class="select2-search"> <label for="s2id_autogen6_search" class="select2-offscreen"></label> <input type="text"
                                            autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="select2-input"
                                            role="combobox" aria-expanded="true" aria-autocomplete="list" aria-owns="select2-results-6"
                                            id="s2id_autogen6_search" placeholder=""> </div>
                                    <ul class="select2-results" role="listbox" id="select2-results-6"> </ul>
                                </div>
                            </div><select id="date-unit" style="width:100%" title="" class="select2-offscreen" tabindex="-1">
                        <option value="d">天</option>
                        <option value="h">时</option>
                        <option value="m">分</option>
                        <option value="s">秒</option>
                    </select>
                        </div>
                    </div>
                </div>
                <div id="coverDiv" style="display:none">
                    <div class="setApply" id="setCoverUserAndUnit">
                        <i class="fa fa-w fa-plus"></i>&nbsp;指定用户
                    </div>
                </div>
                <div id="createDiv" style="display:none">
                    <div class="setApply" id="setCreateUserAndUnit">
                        <i class="fa fa-w fa-plus"></i>&nbsp;指定用户
                    </div>
                </div>
                <div id="forbidDiv" style="display:none">
                    <div class="setApply" id="setForbidSaveUserAndUnit">
                        <i class="fa fa-w fa-plus"></i>&nbsp;指定用户
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="pull-left btn-link" id="setRepeat" style="font-size: 14px;color:#999999" data-container="body" data-toggle="popover">启用查重</button>
                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>
                    <button type="button" id="setFieldAttr" class="btn btn-primary" onclick="LM.setFieldAttr();">保存</button>
                </div>
            </div>
        </div>
    </div>

</body>
#include("../../components/common.html")
<script src="../../../../src/scripts/js/plug-in/drag/Sortable.min.js"></script>
<script src="../../../../src/scripts/js/cloud/menu/index_common.js"></script>
<script>
    /*************************视图显示部分js****************************/
    var formFieldList = {};
    var hideFieldList = []; //右侧备选字段数据
    var showFieldList = []; //左侧显示字段数据

    var selectedField; //视图显示，选择修改的字段的li
    var selectedLineBar; //视图显示，选择修改的分线栏

    var urlParams = getUrlParams();
    $(function () {
        if (!urlParams.formId) {
            tipsMsg("参数错误", "FAIL");
            return;
        }
        getFieldData();
        initField();


        //点击左侧标题，收起ul
        /* $(document).on("click",".item-title-info",function(){
            $(this).parent().parent().find("ul.item-content").toggle();
        }); */
    });

    //获取表单字段及用户设置信息【表单字段-左侧显示字段=右侧备选字段】
    function getFieldData() {
        $.ajax({
            url: ctx + "/cloud/form/handler/getForm/obj",
            type: "post",
            async: false,
            data: {
                formId: urlParams.formId
            },
            success: function (json) {
                if (json.result == "Success" || json.result == "SUCCESS") {
                    var formObj = json.map.obj;
                    //$(".show-content-header-title").text(formObj.name);
                    var setting = JSON.parse(formObj.setting);
                    var allFieldList = setting.formFieldList;
                    if (allFieldList && allFieldList.length > 0) {
                        $.each(allFieldList, function (i, obj) {
                            var field = {
                                html_type: obj.html_type,
                                name: obj.name,
                                val_key: obj.val_key,
                                is_show: obj.is_show,
                                is_null: obj.is_null,
                                elem_width: obj.elem_width,
                                is_drag: obj.is_null
                            };
                            formFieldList[obj.val_key] = field;
                        });
                    }
                } else {
                    tipsMsg(json.resultMsg, "FAIL");
                }
            }
        });
        $.ajax({
            url: ctx + "/cloud/userUiConfig/getConfig",
            type: "get",
            async: false,
            data: {
                tableId: urlParams.formId,
                type: "FORM_VIEW_SETTING"
            },
            success: function (json) {
                if (json.result == "Success" || json.result == "SUCCESS") {
                    if (json.map) { //用户保存过设置信息
                        $("#id").val(json.map.id);
                        if (json.map.setting) {
                            var setting = JSON.parse(json.map.setting);
                            showFieldList = setting.showFields;
                            $.each(showFieldList, function (i, obj) {
                                delete formFieldList[obj.val_key]; //从所有表单字段中移除显示的字段，剩下的为备选字段
                            });
                            $.each(formFieldList, function (i, obj) {
                                if (obj.html_type != "LINEBAR") {
                                    hideFieldList.push(obj);
                                }
                            });
                        }
                    } else { //首次设置，没有保存过设置信息
                        $.each(formFieldList, function (i, obj) {
                            showFieldList.push(obj);
                        });
                    }
                } else {
                    tipsMsg(json.resultMsg, "FAIL");
                }
            }
        });
    }

    //初始化html
    function initField() {
        if (hideFieldList && hideFieldList.length > 0) { //初始化备选字段
            for (var i = 0; i < hideFieldList.length; i++) {
                var classStr = ""
                var requireNode = "";
                if (hideFieldList[i].is_show == "0") {
                    classStr += " field-hide";
                }
                if (hideFieldList[i].is_null == "0") {
                    requireNode = "<font class='red'>*</font>"
                }
                $("#left").append("<li class='right-style " + classStr + "' key='halfLine' val_key='" + hideFieldList[i]
                    .val_key + "' name='" + hideFieldList[i].name + "' elem_width='12' is_null='" + hideFieldList[i]
                    .is_null + "' is_show='" + hideFieldList[i].is_show + "' is_drag='" + hideFieldList[i].is_drag +
                    "'>" +
                    "<div class='left-content'>" +
                    requireNode +
                    "<span class='flied-name'>" +
                    hideFieldList[i].name +
                    "</span>" +
                    "</div>" +
                    "</li>");
            }
        }
        if (showFieldList && showFieldList.length > 0) { //初始化视图显示字段
            for (var i = 0; i < showFieldList.length; i++) {
                if (showFieldList[i].html_type == "LINEBAR") {
                    $("#right").append("<li class='left-style col-12' html_type='LINEBAR' name='" + showFieldList[i].name +
                        "' is_show='" + showFieldList[i].is_show + "' key='halfLine' draggable='false'>" +
                        "<div class='item-title'>" +
                        "<span class='item-title-info'>" +
                        "<i class='fa fa-caret-down' aria-hidden='true'></i>" +
                        "<span class='lineBarName'>" + showFieldList[i].name + "</span>" +
                        "</span>" +
                        "</div>" +
                        "</li>");
                } else {
                    var classStr = "col-12";
                    var elem_width = "12";
                    var requireNode = "";
                    if (showFieldList[i].elem_width) {
                        classStr = " col-" + showFieldList[i].elem_width;
                        elem_width = showFieldList[i].elem_width;
                    }
                    if (showFieldList[i].is_show == "0") {
                        classStr += " field-hide";
                    }
                    if (showFieldList[i].is_null == "0") {
                        requireNode = "<font class='red'>*</font>"
                    }
                    $("#right").append("<li class='left-style " + classStr + "' key='halfLine' val_key='" +
                        showFieldList[i].val_key + "' name='" + showFieldList[i].name + "' elem_width='" +
                        elem_width + "' is_null='" + showFieldList[i].is_null + "' is_show='" + showFieldList[i].is_show +
                        "' is_drag='" + showFieldList[i].is_drag + "'>" +
                        "<div class='left-content'>" +
                        requireNode +
                        "<span class='flied-name'>" +
                        showFieldList[i].name +
                        "</span>" +
                        "</div>" +
                        "</li>");
                }
            }
        }
    }



    //鼠标移入字段显示操作按钮
    $(document).on("mouseenter", ".left-style", function () {
        var elem_width = $(this).attr("elem_width");
        var is_drag = $(this).attr("is_drag");
        var operateContent =
            "<div class='btn-group btn-group-xs pull-right' style='position:absolute;top: 7px;right: 20px; display: block;'>" +
            (is_drag == "1" ? "<button class='btn btn-default' onclick='fieldRequire(this)'>必填</button>" : "") +
            '<select class="btn btn-default" onchange="editfieldWidth(this)" style="height:22px;width:47px;padding:0;">' +
            '<option value="12" ' + (elem_width == "12" ? "selected" : "") + '>整行</option>' +
            '<option value="6" ' + (elem_width == "6" ? "selected" : "") + '>半行</option>' +
            '<option value="4" ' + (elem_width == "4" ? "selected" : "") + '>1/3</option>' +
            '<option value="3" ' + (elem_width == "3" ? "selected" : "") + '>1/4</option>' +
            '</select>' +
            "<button class='btn btn-default' onclick='editFiledName(this)'>修改</button>" +
            (is_drag == "1" ? "<button class='btn btn-default' onclick='removeFieldContent(this)'>移除</button>" :
                "") +
            //"<button class='btn btn-default' onclick='editProperty(this)'>属性</button>"+
            "</div>";
        if ($(this).attr("html_type") == "LINEBAR") {
            operateContent =
                "<div class='btn-group btn-group-xs pull-right' style='position:absolute;top: 8px;right: 20px; display: block;'>" +
                "<button class='btn btn-default editLineBarBtn'>修改</button>" +
                "<button class='btn btn-default deleteLineBarBtn'>移除</button>" +
                "</div>";
        }
        $(this).append(operateContent);
    });
    //鼠标移出字段隐藏操作按钮
    $(document).on("mouseleave", ".left-style", function () {
        $(this).find(".btn-group").remove();
    });


    //字段是否必填
    function fieldRequire(_this) {
        //通过给li添加属性 require来判断是否是必填项
        var li = $(_this).parents("li");
        var content = li.find(".left-content");
        var requireNode = "<font class='red'>*</font>";
        if (li.attr("is_null") == "0") {
            content.find(".red").remove();
            li.attr("is_null", "1");
        } else {
            content.prepend(requireNode);
            li.attr("is_null", "0");
        }
    }

    //字段显示宽度
    function editfieldWidth(_this) {
        var elem_width = $(_this).val();
        var li = $(_this).parents("li");
        li.attr("elem_width", elem_width);
        li.removeClass("col-12 col-6 col-4 col-3").addClass("col-" + elem_width);
    }

    //打开字段名称、宽度修改弹窗
    function editFiledName(_this) {
        selectedField = $(_this).parents("li");
        $("#editFieldModal").find("[name=name]").val(selectedField.find(".flied-name").text());
        $("#editFieldModal").find("[name=elem_width]").val(selectedField.attr("elem_width") ? selectedField.attr(
            "elem_width") : "12");
        $("#editFieldModal").modal();
    }
    //保存字段名称、宽度
    $("#editFieldModal").on("click", ".btn-primary", function () {
        var name = $("#editFieldModal").find("[name=name]").val();
        var elem_width = $("#editFieldModal").find("[name=elem_width]").val();
        if (selectedField && selectedField.length > 0) {
            selectedField.attr("name", name);
            selectedField.attr("elem_width", elem_width);
            selectedField.find(".flied-name").text(name);
            selectedField.removeClass("col-12 col-6 col-4 col-3").addClass("col-" + elem_width);
        }
        $("#editFieldModal").modal('hide');
    });
    //移除字段
    function removeFieldContent(_this) {
        // if($(_this).parents("li").attr("is_null")=="0"){	//去除必填样式
        // fieldRequire(_this);
        // }
        var li = $(_this).parents("li");
        li.find(".btn-group").remove(); //去除操作按钮
        li.removeClass("left-style col-12 col-6 col-4 col-3").addClass("right-style");
        li.find(".left-content").css("border", "1px solid rgba(0,0,0,.125)");
        $("#left").append(li);
    }

    //修改字段属性
    /* function editProperty(_this){
        $("#fieldAttrModal").modal();
    } */

    //打开分线栏修改弹窗
    $(document).on("click", ".editLineBarBtn", function () {
        selectedLineBar = $(this).parents("li");
        $("#editLineBarModal").find("[name=name]").val("");
        $("#editLineBarModal").find("[name=is_show]").prop("checked", false);
        if (selectedLineBar && selectedLineBar.length > 0) {
            $("#editLineBarModal").find("[name=name]").val(selectedLineBar.attr("name"));
            $("#editLineBarModal").find("[name=is_show]").prop("checked", selectedLineBar.attr("is_show") ==
                "0");
        }
        $("#editLineBarModal").modal();
    });

    //保存分线栏
    $("#editLineBarModal").on("click", ".btn-primary", function () {
        var name = $.trim($("#editLineBarModal").find("[name=name]").val());
        if (!name) {
            name = "分线栏";
        }
        var is_show = $("#editLineBarModal").find("[name='is_show']:checked").val() == "0" ? "0" : "1";;
        if (selectedLineBar && selectedLineBar.length > 0) { //修改
            selectedLineBar.attr("name", name).attr("is_show", is_show);
            selectedLineBar.find(".lineBarName").text(name);
        } else { //新增
            $("#right").append('<li class="left-style col-12" html_type="LINEBAR" name="' + name +
                '" is_show="' + is_show + '" key="halfLine" draggable="false">' +
                '<div class="item-title">' +
                '<span class="item-title-info">' +
                '<i class="fa fa-caret-down" aria-hidden="true"></i>' +
                '<span class="lineBarName">' + name + '</span>' +
                '</span>' +
                '</div>' +
                '</li>');
        }
        $("#editLineBarModal").modal('hide');
    });

    //删除分线栏
    $(document).on("click", ".deleteLineBarBtn", function () {
        $(this).parents("li").remove();
    });


    /**
     * 保存设置信息
     */
    function saveViewSetting() {
        var showFields = [];
        $.each($("#right").find(".left-style"), function () {
            var field = {
                "name": $(this).attr("name"),
                "is_show": $(this).attr("is_show")
            };
            if ($(this).attr("html_type") == "LINEBAR") {
                field.html_type = "LINEBAR";
            } else {
                field.val_key = $(this).attr("val_key");
                field.is_null = $(this).attr("is_null");
                field.elem_width = $(this).attr("elem_width");
                field.is_drag = $(this).attr("is_drag");
            }
            showFields.push(field);
        });
        var setting = {
            "showFields": showFields
        };
        var loadMsg = layer.msg("正在保存...", {
            icon: 16,
            shade: [0.1, '#393D49'],
            time: 60000
        });
        $.post(ctx + "/cloud/userUiConfig/saveConfigAdmin", {
            "id": $("#id").val(),
            "type": "FORM_VIEW_SETTING",
            "tableId": urlParams.formId,
            "setting": JSON.stringify(setting)
        }, function (json) {
            layer.close(loadMsg);
            if (json.result == "SUCCESS") {
                window.parent.tipsMsg("保存成功", "SUCCESS");
                window.parent.cloudOpenWindow(true);
            } else {
                tipsMsg(json.resultMsg, "FAIL");
            }
        });
    }

    /***************************初始化拖拽效果*************************/
    var left = document.getElementById('left');
    var right = document.getElementById('right');

    //  Shared lists
    new Sortable(left, {
        group: 'shared', // set both lists to same group
        animation: 150,
        ghostClass: 'left-style'
    });

    new Sortable(right, {
        group: {
            name: "shared",
            pull: false, //则可以拖拽到其他列表 否则反之
            put: true //则可以从其他列表中放数据到该列表，false则反之
        },
        animation: 150,
        ghostClass: 'right-style'
    });

    Sortable.create(document.getElementById('right'), { //从右边往左边拖动  right=>left       右往左
        animation: 150, //动画参数
        onAdd: function (evt) { //拖拽时候添加有新的节点的时候发生该事件
            console.log('onAdd.foo:', [evt.item, evt.from]);
            var element = $(evt.item);
            console.log(evt.item);
            $(evt.item).removeClass("right-style").addClass("left-style col-12").attr("elem_width", "12"); //从右侧拖入左侧时，移除右侧的样式，添加左侧的样
            //$(evt.item).attr({"widhtpercent":"半行","value":"6"});    //拖入左侧时默认宽度为半行
            highBorderLight($(evt.item).find(".left-content"));

            //增加按钮编辑功能
        },
        onUpdate: function (evt) { //拖拽更新节点位置发生该事件
            console.log('onUpdate.foo:', [evt.item, evt.from]);
        },
        onRemove: function (evt) { //删除拖拽节点的时候促发该事件
            console.log('onRemove.foo:', [evt.item, evt.from]);
        },
        onStart: function (evt) { //开始拖拽出发该函数
            console.log('onStart.foo:', [evt.item, evt.from]);
        },
        onSort: function (evt) { //发生排序发生该事件
            console.log('onSort.foo:', [evt.item, evt.from]);
        },
        onEnd: function (evt) { //拖拽完毕之后发生该事件
            console.log('onEnd.foo:', [evt.item, evt.from]);
        }
    })

    function highBorderLight(e) {
        var border = '1px dashed rgb(205, 197, 211)';
        var num = 0;
        var i = self.setInterval(function () {
            e.css('border', num % 2 == 0 ? '1px dashed red' : border);
            num++;
            if (num > 9)
                window.clearInterval(i);
        }, 100);
        return $(this);
    }
</script>

</html>